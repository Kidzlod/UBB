-- FULL: DHL - UBB (UI + AllChar + Hitbox + ESP + Delete + Console)
-- Tabs: Main / Setting (ESP gộp trong Setting)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer
local PlayerGui = LP:WaitForChild("PlayerGui")

-- Safe remotes
local UIRemotes = ReplicatedStorage:FindFirstChild("UIRemotes")
local AstroPurchase = UIRemotes and UIRemotes:FindFirstChild("AstroPurchase")
local CraftRemote = UIRemotes and UIRemotes:FindFirstChild("Craft")

-- States
_G.HeadSize = tonumber(_G.HeadSize) or 100
_G.HitboxEnabled = _G.HitboxEnabled or false
_G.ESP_Enabled = _G.ESP_Enabled or false
_G.ESP_Color = _G.ESP_Color or Color3.fromRGB(0,255,0)

-- ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DHL_UBB_UI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

-- Toggle button
local toggleBtn = Instance.new("TextButton", ScreenGui)
toggleBtn.Size = UDim2.new(0, 66, 0, 36)
toggleBtn.Position = UDim2.new(0.03,0,0.42,0)
toggleBtn.Text = "MENU"
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 15
toggleBtn.BackgroundColor3 = Color3.fromRGB(25,25,25)
toggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0,10)
toggleBtn.Draggable = true

-- Main window
local main = Instance.new("Frame", ScreenGui)
main.Size = UDim2.new(0, 340, 0, 420)
main.Position = UDim2.new(0.18, 0, 0.12, 0)
main.BackgroundColor3 = Color3.fromRGB(12,12,12)
main.BorderSizePixel = 0
main.Visible = false
Instance.new("UICorner", main).CornerRadius = UDim.new(0,12)
local stroke = Instance.new("UIStroke", main) stroke.Thickness = 3

-- Title + rainbow
local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1, -20, 0, 36)
title.Position = UDim2.new(0, 10, 0, 6)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.Text = "DHL - UBB"
title.TextColor3 = Color3.fromRGB(255,255,255)
title.TextXAlignment = Enum.TextXAlignment.Left

task.spawn(function()
    local t=0
    while task.wait(0.05) do
        t=t+1
        local r=math.floor((math.sin(t/20)*127+128))
        local g=math.floor((math.sin(t/20+2)*127+128))
        local b=math.floor((math.sin(t/20+4)*127+128))
        local c=Color3.fromRGB(r,g,b)
        stroke.Color=c
        title.TextColor3=c
    end
end)

-- Tab bar
local tabBar = Instance.new("Frame", main)
tabBar.Size = UDim2.new(1, -20, 0, 36)
tabBar.Position = UDim2.new(0, 10, 0, 48)
tabBar.BackgroundTransparency = 1
local tLayout = Instance.new("UIListLayout", tabBar)
tLayout.FillDirection = Enum.FillDirection.Horizontal
tLayout.Padding = UDim.new(0,8)

local function newTab(name)
    local b = Instance.new("TextButton", tabBar)
    b.Size = UDim2.new(0, 110, 1, 0)
    b.Text = name
    b.Font = Enum.Font.Gotham
    b.TextSize = 14
    b.BackgroundColor3 = Color3.fromRGB(28,28,28)
    b.TextColor3 = Color3.fromRGB(255,255,255)
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,8)
    return b
end

local tabMain = newTab("Main")
local tabSet = newTab("Setting")

-- Content frames
local contentMain = Instance.new("ScrollingFrame", main)
contentMain.Size = UDim2.new(1, -20, 1, -100)
contentMain.Position = UDim2.new(0,10,0,92)
contentMain.BackgroundTransparency=1
contentMain.Visible=true
contentMain.AutomaticCanvasSize="Y"
local layoutMain = Instance.new("UIListLayout", contentMain)
layoutMain.Padding=UDim.new(0,8)

local contentSet = Instance.new("ScrollingFrame", main)
contentSet.Size=UDim2.new(1,-20,1,-100)
contentSet.Position=UDim2.new(0,10,0,92)
contentSet.BackgroundTransparency=1
contentSet.Visible=false
contentSet.AutomaticCanvasSize="Y"
local layoutSet=Instance.new("UIListLayout",contentSet)
layoutSet.Padding=UDim.new(0,8)

-- Helper button
local function createButton(text, parent)
    local b=Instance.new("TextButton")
    b.Size=UDim2.new(1,0,0,40)
    b.BackgroundColor3=Color3.fromRGB(32,32,32)
    b.Font=Enum.Font.Gotham
    b.TextSize=15
    b.TextColor3=Color3.fromRGB(255,255,255)
    b.Text=text
    Instance.new("UICorner", b).CornerRadius=UDim.new(0,8)
    b.Parent=parent
    return b
end

-- Console
local console=Instance.new("Frame",ScreenGui)
console.Size=UDim2.new(0,420,0,220)
console.Position=UDim2.new(0.55,0,0.12,0)
console.BackgroundColor3=Color3.fromRGB(10,10,10)
console.Visible=false
Instance.new("UICorner",console).CornerRadius=UDim.new(0,10)

local conScroll=Instance.new("ScrollingFrame",console)
conScroll.Size=UDim2.new(1,-16,1,-16)
conScroll.Position=UDim2.new(0,8,0,8)
conScroll.BackgroundTransparency=1
conScroll.AutomaticCanvasSize="Y"
conScroll.ScrollBarThickness=6
local conList=Instance.new("UIListLayout",conScroll) conList.Padding=UDim.new(0,6)

local function AddLog(text)
    local t=Instance.new("TextLabel",conScroll)
    t.Size=UDim2.new(1,-10,0,18)
    t.BackgroundTransparency=1
    t.Font=Enum.Font.Code
    t.TextSize=12
    t.TextColor3=Color3.fromRGB(200,200,200)
    t.TextXAlignment=Enum.TextXAlignment.Left
    t.Text=text
    task.delay(0.05,function() conScroll.CanvasPosition=Vector2.new(0,conScroll.AbsoluteCanvasSize.Y) end)
end

-- Main buttons
local btnAllChar=createButton("ALL CHAR",contentMain)
btnAllChar.MouseButton1Click:Connect(function()
    AddLog("[AllChar] Running...")
    -- code call remote ở đây
end)

local btnDeleteNR=createButton("Delete Night/Rain",contentMain)
btnDeleteNR.MouseButton1Click:Connect(function()
    AddLog("[Delete] Running...")
    -- code xóa night/rain ở đây
end)

-- Setting tab controls
local hitboxBox=Instance.new("TextBox",contentSet)
hitboxBox.Size=UDim2.new(1,0,0,40)
hitboxBox.Text=tostring(_G.HeadSize)
hitboxBox.Font=Enum.Font.SourceSans
hitboxBox.TextSize=16
hitboxBox.ClearTextOnFocus=false
hitboxBox.BackgroundColor3=Color3.fromRGB(40,40,40)
Instance.new("UICorner",hitboxBox).CornerRadius=UDim.new(0,8)

createButton("Bật/Tắt Hitbox",contentSet).MouseButton1Click:Connect(function()
    _G.HitboxEnabled=not _G.HitboxEnabled
    AddLog("[Hitbox] "..(_G.HitboxEnabled and "ON" or "OFF"))
end)

createButton("+50 Hitbox",contentSet).MouseButton1Click:Connect(function()
    _G.HeadSize=_G.HeadSize+50
    hitboxBox.Text=tostring(_G.HeadSize)
end)

createButton("-50 Hitbox",contentSet).MouseButton1Click:Connect(function()
    _G.HeadSize=_G.HeadSize-50
    hitboxBox.Text=tostring(_G.HeadSize)
end)

-- ESP in Setting
createButton("ESP ON/OFF",contentSet).MouseButton1Click:Connect(function()
    _G.ESP_Enabled=not _G.ESP_Enabled
    AddLog("[ESP] "..(_G.ESP_Enabled and "ON" or "OFF"))
end)

createButton("ESP Color: Cycle",contentSet).MouseButton1Click:Connect(function()
    local colors={
        Color3.fromRGB(0,255,0),
        Color3.fromRGB(0,170,255),
        Color3.fromRGB(255,200,0),
        Color3.fromRGB(255,80,80),
        Color3.fromRGB(255,0,255)
    }
    local idx=table.find(colors,_G.ESP_Color) or 1
    idx=idx%#colors+1
    _G.ESP_Color=colors[idx]
    AddLog("[ESP] Color changed")
end)

createButton("Toggle Console",contentSet).MouseButton1Click:Connect(function()
    console.Visible=not console.Visible
end)

-- Tab switching
tabMain.MouseButton1Click:Connect(function()
    contentMain.Visible=true
    contentSet.Visible=false
end)
tabSet.MouseButton1Click:Connect(function()
    contentMain.Visible=false
    contentSet.Visible=true
end)

-- Toggle button
toggleBtn.MouseButton1Click:Connect(function()
    main.Visible=not main.Visible
end)

AddLog("DHL - UBB loaded. UI ready.")
