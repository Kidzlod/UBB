-- DHL - UBB Hub (Full Script)
-- UI + Main + Setting + ESP + Hitbox Fix (TextBox mặc định = 100)

--// Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

--// Global Vars
_G.HeadSize = 100
_G.HitboxEnabled = false
_G.ESPEnabled = false

--// UI Library
local ScreenGui = Instance.new("ScreenGui", PlayerGui)
ScreenGui.Name = "DHL_UBB"

-- Main frame
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0.3, 0, 0.2, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 12)

-- Rainbow border effect
local UIStroke = Instance.new("UIStroke", MainFrame)
UIStroke.Thickness = 3
UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
task.spawn(function()
    while task.wait() do
        for i = 0, 1, 0.01 do
            UIStroke.Color = Color3.fromHSV(i, 1, 1)
            task.wait(0.05)
        end
    end
end)

-- Title
local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Text = "DHL - UBB"
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20

-- Tabs container
local TabButtons = Instance.new("Frame", MainFrame)
TabButtons.Size = UDim2.new(1, 0, 0, 40)
TabButtons.Position = UDim2.new(0, 0, 0, 40)
TabButtons.BackgroundTransparency = 1

local ContentFrame = Instance.new("Frame", MainFrame)
ContentFrame.Size = UDim2.new(1, -20, 1, -100)
ContentFrame.Position = UDim2.new(0, 10, 0, 90)
ContentFrame.BackgroundTransparency = 1

-- UI pages
local Pages = {}

local function CreatePage(name)
    local page = Instance.new("ScrollingFrame", ContentFrame)
    page.Size = UDim2.new(1, 0, 1, 0)
    page.Visible = false
    page.ScrollBarThickness = 6
    page.Name = name
    Pages[name] = page
    return page
end

local function SwitchPage(name)
    for _, pg in pairs(Pages) do
        pg.Visible = false
    end
    if Pages[name] then
        Pages[name].Visible = true
    end
end

-- Tab buttons
local function CreateTabButton(name)
    local btn = Instance.new("TextButton", TabButtons)
    btn.Size = UDim2.new(0, 100, 1, 0)
    btn.Text = name
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 16
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
    btn.MouseButton1Click:Connect(function()
        SwitchPage(name)
    end)
    return btn
end

-- Create Pages
local MainPage = CreatePage("Main")
local SettingPage = CreatePage("Setting")

-- Tabs
local mainBtn = CreateTabButton("Main")
local setBtn = CreateTabButton("Setting")
setBtn.Position = UDim2.new(0, 110, 0, 0)

-- Default page
SwitchPage("Main")

--// MAIN TAB: All Char + ESP Toggle
local allCharBtn = Instance.new("TextButton", MainPage)
allCharBtn.Size = UDim2.new(1, -10, 0, 40)
allCharBtn.Position = UDim2.new(0, 5, 0, 10)
allCharBtn.Text = "ALL CHAR"
allCharBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
allCharBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", allCharBtn).CornerRadius = UDim.new(0, 8)

allCharBtn.MouseButton1Click:Connect(function()
    local target = LocalPlayer:WaitForChild("PlayerGui")
        :WaitForChild("MainUI")
        :WaitForChild("StoreFrame")
        :WaitForChild("Content")
        :WaitForChild("Passes")
        :WaitForChild("Content")
        :WaitForChild("Left")
    for _, obj in pairs(target:GetChildren()) do
        local args1 = { obj.Name, 0.001 }
        ReplicatedStorage.UIRemotes.AstroPurchase:FireServer(unpack(args1))

        local args2 = { obj.Name, { Coins = 1 } }
        ReplicatedStorage.UIRemotes.Craft:FireServer(unpack(args2))
    end

    for _, obj in pairs(ReplicatedStorage:WaitForChild("Morphshow"):GetChildren()) do
        local args1 = { obj.Name, 0.001 }
        ReplicatedStorage.UIRemotes.AstroPurchase:FireServer(unpack(args1))

        local args2 = { obj.Name, { Coins = 1 } }
        ReplicatedStorage.UIRemotes.Craft:FireServer(unpack(args2))
    end
end)

local espBtn = Instance.new("TextButton", MainPage)
espBtn.Size = UDim2.new(1, -10, 0, 40)
espBtn.Position = UDim2.new(0, 5, 0, 60)
espBtn.Text = "ESP: OFF"
espBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
espBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", espBtn).CornerRadius = UDim.new(0, 8)

espBtn.MouseButton1Click:Connect(function()
    _G.ESPEnabled = not _G.ESPEnabled
    espBtn.Text = _G.ESPEnabled and "ESP: ON" or "ESP: OFF"
end)

--// SETTING TAB: Hitbox Toggle + Size Box
local hitboxBtn = Instance.new("TextButton", SettingPage)
hitboxBtn.Size = UDim2.new(1, -10, 0, 40)
hitboxBtn.Position = UDim2.new(0, 5, 0, 10)
hitboxBtn.Text = "Hitbox: OFF"
hitboxBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
hitboxBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", hitboxBtn).CornerRadius = UDim.new(0, 8)

hitboxBtn.MouseButton1Click:Connect(function()
    _G.HitboxEnabled = not _G.HitboxEnabled
    hitboxBtn.Text = _G.HitboxEnabled and "Hitbox: ON" or "Hitbox: OFF"
end)

-- FIXED TextBox
local hitboxBox = Instance.new("TextBox", SettingPage)
hitboxBox.Size = UDim2.new(1, -10, 0, 40)
hitboxBox.Position = UDim2.new(0, 5, 0, 60)
hitboxBox.Text = tostring(_G.HeadSize) -- mặc định 100
hitboxBox.Font = Enum.Font.SourceSans
hitboxBox.TextSize = 16
hitboxBox.ClearTextOnFocus = false
hitboxBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
hitboxBox.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", hitboxBox).CornerRadius = UDim.new(0, 8)

hitboxBox.FocusLost:Connect(function()
    local num = tonumber(hitboxBox.Text)
    if num and num > 0 then
        _G.HeadSize = num
    else
        hitboxBox.Text = tostring(_G.HeadSize)
    end
end)

-- Delete Night/Rain
local delBtn = Instance.new("TextButton", SettingPage)
delBtn.Size = UDim2.new(1, -10, 0, 40)
delBtn.Position = UDim2.new(0, 5, 0, 110)
delBtn.Text = "Delete Night/Rain"
delBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
delBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
Instance.new("UICorner", delBtn).CornerRadius = UDim.new(0, 8)

delBtn.MouseButton1Click:Connect(function()
    local gfx = ReplicatedStorage:FindFirstChild("Assets"):FindFirstChild("GRAPHIC")
    if gfx then
        if gfx:FindFirstChild("night") then gfx.night:Destroy() end
        if gfx:FindFirstChild("rain") then gfx.rain:Destroy() end
    end
end)

--// HITBOX LOOP
RunService.RenderStepped:Connect(function()
    if _G.HitboxEnabled then
        for _, v in pairs(Players:GetPlayers()) do
            if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = v.Character.HumanoidRootPart
                hrp.Size = Vector3.new(_G.HeadSize, _G.HeadSize, _G.HeadSize)
                hrp.Transparency = 0.7
                hrp.BrickColor = BrickColor.new("Really blue")
                hrp.Material = Enum.Material.Neon
                hrp.CanCollide = false
            end
        end
    end
end)

--// ESP LOOP
RunService.RenderStepped:Connect(function()
    if _G.ESPEnabled then
        for _, v in pairs(Players:GetPlayers()) do
            if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("Head") then
                local head = v.Character.Head
                if not head:FindFirstChild("DHL_ESP") then
                    local billboard = Instance.new("BillboardGui", head)
                    billboard.Name = "DHL_ESP"
                    billboard.Size = UDim2.new(0, 200, 0, 50)
                    billboard.Adornee = head
                    billboard.AlwaysOnTop = true

                    local nameLabel = Instance.new("TextLabel", billboard)
                    nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
                    nameLabel.BackgroundTransparency = 1
                    nameLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                    nameLabel.Text = v.Name
                    nameLabel.TextScaled = true

                    local distLabel = Instance.new("TextLabel", billboard)
                    distLabel.Position = UDim2.new(0, 0, 0.5, 0)
                    distLabel.Size = UDim2.new(1, 0, 0.5, 0)
                    distLabel.BackgroundTransparency = 1
                    distLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                    distLabel.TextScaled = true

                    RunService.RenderStepped:Connect(function()
                        if v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                            local dist = (LocalPlayer.Character.HumanoidRootPart.Position - v.Character.HumanoidRootPart.Position).Magnitude
                            distLabel.Text = string.format("Dist: %.0f", dist)
                        end
                    end)
                end
            end
        end
    end
end)
