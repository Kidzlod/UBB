-- DHL - UBB Full Script
-- UI Đen + Viền 7 màu đổi liên tục
-- Menu có thể di chuyển, có nút ON/OFF, đủ tính năng

--// Khởi tạo UI
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UDim2_new, Instance_new = UDim2.new, Instance.new

-- Xóa UI cũ nếu có
if CoreGui:FindFirstChild("DHL_UBB_UI") then
    CoreGui.DHL_UBB_UI:Destroy()
end

local ScreenGui = Instance_new("ScreenGui")
ScreenGui.Name = "DHL_UBB_UI"
ScreenGui.Parent = CoreGui

-- Nút mở menu
local ToggleButton = Instance_new("TextButton")
ToggleButton.Text = "MENU"
ToggleButton.Size = UDim2_new(0, 80, 0, 35)
ToggleButton.Position = UDim2_new(0, 20, 0.2, 0)
ToggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Font = Enum.Font.SourceSansBold
ToggleButton.TextSize = 20
ToggleButton.Parent = ScreenGui
ToggleButton.ZIndex = 5

-- Frame chính
local MainFrame = Instance_new("Frame")
MainFrame.Size = UDim2_new(0, 380, 0, 300)
MainFrame.Position = UDim2_new(0.5, -190, 0.5, -150)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = true
MainFrame.Parent = ScreenGui

-- Viền 7 màu đổi liên tục
local UICorner = Instance_new("UICorner", MainFrame)
UICorner.CornerRadius = UDim.new(0, 12)

local UIStroke = Instance_new("UIStroke", MainFrame)
UIStroke.Thickness = 3
UIStroke.Color = Color3.fromRGB(255, 0, 0)

task.spawn(function()
    local hue = 0
    while task.wait(0.05) do
        hue = (hue + 1) % 255
        UIStroke.Color = Color3.fromHSV(hue/255, 1, 1)
    end
end)

-- Kéo thả menu
local dragging, dragInput, dragStart, startPos
MainFrame.Active = true
MainFrame.Draggable = true

-- Nút bật/tắt menu chính
local function toggleMenu()
    MainFrame.Visible = not MainFrame.Visible
end
ToggleButton.MouseButton1Click:Connect(toggleMenu)

-- Title
local Title = Instance_new("TextLabel")
Title.Size = UDim2_new(1, 0, 0, 40)
Title.BackgroundTransparency = 1
Title.Text = "DHL - UBB"
Title.TextColor3 = Color3.fromRGB(0, 255, 150)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 22
Title.Parent = MainFrame

-- Tabs
local TabButtons = Instance_new("Frame", MainFrame)
TabButtons.Size = UDim2_new(1, 0, 0, 35)
TabButtons.Position = UDim2_new(0, 0, 0, 40)
TabButtons.BackgroundTransparency = 1

local MainTab = Instance_new("TextButton", TabButtons)
MainTab.Size = UDim2_new(0.5, -2, 1, 0)
MainTab.Position = UDim2_new(0, 0, 0, 0)
MainTab.Text = "Main"
MainTab.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainTab.TextColor3 = Color3.fromRGB(255, 255, 255)

local SettingTab = Instance_new("TextButton", TabButtons)
SettingTab.Size = UDim2_new(0.5, -2, 1, 0)
SettingTab.Position = UDim2_new(0.5, 2, 0, 0)
SettingTab.Text = "Setting"
SettingTab.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
SettingTab.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Nội dung Main
local MainPage = Instance_new("Frame", MainFrame)
MainPage.Size = UDim2_new(1, -10, 1, -90)
MainPage.Position = UDim2_new(0, 5, 0, 80)
MainPage.BackgroundTransparency = 1

-- Nút ALL CHAR
local AllCharBtn = Instance_new("TextButton", MainPage)
AllCharBtn.Size = UDim2_new(1, 0, 0, 35)
AllCharBtn.Position = UDim2_new(0, 0, 0, 0)
AllCharBtn.Text = "ALL CHAR"
AllCharBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
AllCharBtn.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Nút Delete Night/Rain
local DelNRBtn = Instance_new("TextButton", MainPage)
DelNRBtn.Size = UDim2_new(1, 0, 0, 35)
DelNRBtn.Position = UDim2_new(0, 0, 0, 45)
DelNRBtn.Text = "Delete Night/Rain"
DelNRBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
DelNRBtn.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Nội dung Setting
local SettingPage = Instance_new("Frame", MainFrame)
SettingPage.Size = UDim2_new(1, -10, 1, -90)
SettingPage.Position = UDim2_new(0, 5, 0, 80)
SettingPage.BackgroundTransparency = 1
SettingPage.Visible = false

-- ESP On/Off
local ESPBtn = Instance_new("TextButton", SettingPage)
ESPBtn.Size = UDim2_new(1, 0, 0, 35)
ESPBtn.Position = UDim2_new(0, 0, 0, 0)
ESPBtn.Text = "ESP: OFF"
ESPBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
ESPBtn.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Hitbox toggle
local HitboxBtn = Instance_new("TextButton", SettingPage)
HitboxBtn.Size = UDim2_new(1, 0, 0, 35)
HitboxBtn.Position = UDim2_new(0, 0, 0, 45)
HitboxBtn.Text = "Hitbox: OFF"
HitboxBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
HitboxBtn.TextColor3 = Color3.fromRGB(255, 255, 255)

-- TextBox chỉnh hitbox size
local HitboxBox = Instance_new("TextBox", SettingPage)
HitboxBox.Size = UDim2_new(1, 0, 0, 35)
HitboxBox.Position = UDim2_new(0, 0, 0, 90)
HitboxBox.Text = "100"
HitboxBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
HitboxBox.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Tab switching
MainTab.MouseButton1Click:Connect(function()
    MainPage.Visible = true
    SettingPage.Visible = false
end)
SettingTab.MouseButton1Click:Connect(function()
    MainPage.Visible = false
    SettingPage.Visible = true
end)

--// TÍNH NĂNG CODE
local espEnabled = false
local hitboxEnabled = false
_G.HeadSize = 100

ESPBtn.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    ESPBtn.Text = "ESP: " .. (espEnabled and "ON" or "OFF")
end)

HitboxBtn.MouseButton1Click:Connect(function()
    hitboxEnabled = not hitboxEnabled
    HitboxBtn.Text = "Hitbox: " .. (hitboxEnabled and "ON" or "OFF")
end)

HitboxBox.FocusLost:Connect(function()
    local val = tonumber(HitboxBox.Text)
    if val then
        _G.HeadSize = val
    else
        HitboxBox.Text = tostring(_G.HeadSize)
    end
end)

RunService.RenderStepped:Connect(function()
    if hitboxEnabled then
        for _, v in pairs(Players:GetPlayers()) do
            if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = v.Character.HumanoidRootPart
                hrp.Size = Vector3.new(_G.HeadSize, _G.HeadSize, _G.HeadSize)
                hrp.Transparency = 0.7
                hrp.BrickColor = BrickColor.new("Really blue")
                hrp.Material = Enum.Material.Neon
                hrp.CanCollide = false
            end
        end
    end
end)

-- ESP (Tên, HP, Dist)
local function createBillboard(plr)
    if plr.Character and not plr.Character:FindFirstChild("ESPTag") then
        local bb = Instance_new("BillboardGui", plr.Character:WaitForChild("Head"))
        bb.Name = "ESPTag"
        bb.Size = UDim2_new(0,200,0,50)
        bb.AlwaysOnTop = true
        local tl = Instance_new("TextLabel", bb)
        tl.Size = UDim2_new(1,0,1,0)
        tl.BackgroundTransparency = 1
        tl.TextColor3 = Color3.new(1,0,0)
        tl.TextScaled = true
        RunService.RenderStepped:Connect(function()
            if espEnabled and plr.Character and plr.Character:FindFirstChild("Humanoid") then
                local dist = (plr.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).magnitude
                tl.Text = string.format("%s | HP:%d | Dist:%.0f", plr.Name, plr.Character.Humanoid.Health, dist)
                tl.Visible = true
            else
                tl.Visible = false
            end
        end)
    end
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(function()
        task.wait(1)
        createBillboard(plr)
    end)
end)

for _, plr in pairs(Players:GetPlayers()) do
    if plr ~= LocalPlayer then
        createBillboard(plr)
    end
end

-- Delete Night/Rain
DelNRBtn.MouseButton1Click:Connect(function()
    local g = game:GetService("ReplicatedStorage"):FindFirstChild("Assets")
    if g and g:FindFirstChild("GRAPHIC") then
        if g.GRAPHIC:FindFirstChild("Night") then g.GRAPHIC.Night:Destroy() end
        if g.GRAPHIC:FindFirstChild("Rain") then g.GRAPHIC.Rain:Destroy() end
    end
end)

-- ALL CHAR (loop store + morph)
AllCharBtn.MouseButton1Click:Connect(function()
    local pg = LocalPlayer:WaitForChild("PlayerGui")
    local passes = pg:FindFirstChild("MainUI") and pg.MainUI:FindFirstChild("StoreFrame")
    if passes then
        for _, obj in pairs(passes:GetDescendants()) do
            if obj:IsA("TextLabel") then
                local args = {obj.Text, 0.001}
                game.ReplicatedStorage.UIRemotes.AstroPurchase:FireServer(unpack(args))
                local args2 = {obj.Text, {Coins = 1}}
                game.ReplicatedStorage.UIRemotes.Craft:FireServer(unpack(args2))
            end
        end
    end
    if game.ReplicatedStorage:FindFirstChild("Morphshow") then
        for _, obj in pairs(game.ReplicatedStorage.Morphshow:GetChildren()) do
            local args = {obj.Name, 0.001}
            game.ReplicatedStorage.UIRemotes.AstroPurchase:FireServer(unpack(args))
            local args2 = {obj.Name, {Coins = 1}}
            game.ReplicatedStorage.UIRemotes.Craft:FireServer(unpack(args2))
        end
    end
end)
